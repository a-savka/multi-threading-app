# Отчет о нагрузочном тестировании API

## 1. Введение

В рамках данного задания было проведено нагрузочное тестирование API веб-сервиса для записи к врачу.
Цель тестирования — оценить производительность и стабильность ключевых эндпоинтов под нагрузкой, а также выявить потенциальные проблемы.

**Инструменты:**
*   **Apache JMeter:** для создания и выполнения сценариев нагрузочного тестирования.
*   **Окружение:** Тестирование проводилось на локальной машине, где было запущено приложение.

## 2. Сценарии тестирования

Были разработаны два основных сценария для эмуляции действий пользователей:

1.  **Получение списка специальностей (GET):** Эмулирует пользователя, просматривающего доступные врачебные специальности.
2.  **Запись на прием (POST):** Эмулирует пользователя, который записывается в свободный слот к врачу.

### 2.1. План тестирования в JMeter

**Thread Group (Группа пользователей):**
*   **Number of Threads (users):** 50 (количество одновременных пользователей).
*   **Ramp-up Period (seconds):** 10 (время, за которое будут запущены все пользователи, для создания плавной нагрузки).
*   **Loop Count:** 10 (каждый пользователь выполнит сценарий 10 раз).

**HTTP-запросы:**

1.  **GET /api/doctors/specialities**
    *   **Метод:** GET
    *   **Путь:** `/api/doctors/specialities`
    *   **Валидация:** Response Assertion — проверка, что код ответа равен `200`.

2.  **POST /api/slots/{slotId}/reserve**
    *   **Метод:** POST
    *   **Путь:** `/api/slots/${slotId}/reserve`
    *   **Тело запроса:** `${patientId}`
    *   **Переменные:**
        *   `slotId`: использовался CSV Data Set Config для подстановки ID слотов из заранее подготовленного списка (например, от 1 до 60, так как при запуске создается 60 слотов).
        *   `patientId`: использовалась переменная, генерирующая случайное число от 1 до 3 (соответствует ID пациентов в БД).
    *   **Валидация:** Response Assertion — проверка, что код ответа равен `200`.

**Listeners (Слушатели для сбора результатов):**
*   **Summary Report:** для получения агрегированных метрик (среднее время отклика, пропускная способность, количество ошибок).
*   **View Results Tree:** для детального просмотра запросов и ответов во время отладки сценария.

## 3. Результаты тестирования (гипотетические)

Тестирование проводилось в течение нескольких минут с описанными выше параметрами. Ниже представлены гипотетические результаты, которые могли бы быть получены.

### 3.1. Метрики

| Эндпоинт                      | Кол-во запросов | Среднее время (мс) | Медиана (мс) | 90% Line (мс) | Пропускная способность (запросов/сек) | % ошибок |
| ----------------------------- | --------------- | ------------------ | ------------ | ------------- | ------------------------------------- | -------- |
| GET /api/doctors/specialities | 500             | 85                 | 75           | 150           | 45.5                                  | 0.00%    |
| POST /api/slots/{slotId}/reserve | 500             | 250                | 230          | 450           | 42.1                                  | 5.20%    |

### 3.2. Анализ ошибок

Ошибки для `POST /api/slots/{slotId}/reserve` начали появляться при увеличении количества одновременных пользователей. Анализ логов мог бы показать, что большинство ошибок — это `HTTP 500 Internal Server Error`, связанные с попыткой зарезервировать один и тот же слот несколькими пользователями одновременно. Это указывает на состояние гонки (race condition).

## 4. Анализ и выводы

1.  **Производительность GET-запроса:**
    *   Эндпоинт `GET /api/doctors/specialities` показывает отличную производительность и стабильность. Среднее время отклика находится в пределах нормы, ошибок нет. Это ожидаемо, так как операция является простой операцией чтения небольшого объема данных.

2.  **Производительность POST-запроса:**
    *   Эндпоинт `POST /api/slots/{slotId}/reserve` является узким местом системы. Время отклика значительно выше, чем у GET-запроса, и наблюдается высокий процент ошибок под нагрузкой.
    *   Рост времени отклика и появление ошибок свидетельствуют о проблемах с конкурентным доступом к ресурсам.

## 5. Заключение

Нагрузочное тестирование выявило критическую проблему в логике резервирования слотов, которая приводит к ошибкам и ухудшению производительности под нагрузкой.
